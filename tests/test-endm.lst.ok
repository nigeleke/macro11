      1                                 ;;;;;
      2                                 ;
      3                                 ; Test nested macros and name on .ENDM
      4                                 ;
      5                                     .list	me,meb
      6
      7                                     .macro      M1
      8                                     .word       1
      9                                     .endm       M1      ; ok
     10
     11 000000                              M1
      1 000000  000001                      .word       1
     12
     13                                     .macro      M2
     14                                     .word       2
     15                                     .macro      M3
     16                                     .word       3
     17                                     .endm       M3      ; ok
     18                                     .endm       M2      ; ok
     19
     20 000002                              M2
      1 000002  000002                      .word       2
      2                                     .macro      M3
      3                                     .word       3
      4                                     .endm       M3      ; ok
     21 000004                              M3
      1 000004  000003                      .word       3
     22
     23                                     .macro      M4
     24                                     .word       4
     25                                     .macro      M4
     26                                     .endm       M4      ; ok
     27                                     .endm       M4      ; ok
     28
     29 000006                              M4
      1 000006  000004                      .word       4
      2                                     .macro      M4
      3                                     .endm       M4      ; ok
     30 000010                              M4                  ; should be empty now
     31
     32                                     .macro      M5
     33                                     .word       5
     34                                     .macro      M5
     35                                     .endm       notM5   ; wrong; detected when M5 is expanded
     36                                     .endm       M5      ; ok
     37
     38 000010                              M5
      1 000010  000005                      .word       5
      2                                     .macro      M5
test-endm.mac:38->M5:3: ***ERROR .ENDM 'NOTM5' does not match .MACRO 'M5'
      3                                     .endm       notM5   ; wrong; detected when M5 is expanded
     39 000012                              M5
     40
     41                                     .macro      M6
test-endm.mac:42: ***ERROR .ENDM 'NOTM6' does not match .MACRO 'M6'
     42                                     .endm       notM6   ; wrong
     43
test-endm.mac:44: ***ERROR No .MACRO definition block active
     44                                     .endm               ; end without macro
test-endm.mac:45: ***ERROR No repeat block active
     45                                     .endr               ; end without repetition
test-endm.mac:46: ***ERROR No conditional block active
     46                                     .endc               ; end without condition
     47
     48                                     ; Test that a macro that is defined inside another macro isn't already
     49                                     ; defined while defining the outer macro.
     50                                     ; This is a bit tricky: macros are kept between passes, so just
     51                                     ; testing M3 before M2 (like above) won't work.
     52
     53                                     .macro      M7
     54                                      .word      7
     55                                      .if        p2
     56                                       .macro    M8      ; only defined in pass 2
     57                                        .word    8.
     58                                       .endm     M8      ; ok
     59                                      .endc
     60                                     .endm       M7      ; ok
     61
     62 000012  000000G                     M8                  ; not defined yet; will be taken as implied .word.
     63 000014                              M7                  ; defines M8.
      1 000014  000007                       .word      7
      2                                      .if        p2
      3                                       .macro    M8      ; only defined in pass 2
      4                                        .word    8.
      5                                       .endm     M8      ; ok
      6                                      .endc
     64 000016                              M8                  ; which can now be used.
      1 000016  000010                         .word    8.
     64


Symbol table

M8    = ****** GX        .       000020R      001 


Program sections

. ABS.  000000    000   (RW,I,GBL,ABS,OVR,NOSAV)
        000020    001   (RW,I,LCL,REL,CON,NOSAV)
